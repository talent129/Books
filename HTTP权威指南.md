# HTTP: The Definitive Guide etc.

> 著    [美] David Gourley Brian Totty Marjorie Sayer         Sailu Reddy Anshu Aggarwal

> 译    陈 涓 赵振平


HTTP: Hypertext Transfer Protocol，超文本传输协议。是在万维网上进行通信时所使用的协议方案。HTTP有很多应用，最著名的是用于web浏览器和web服务器之间的双工通信。

目的: 为所有希望理解HTTP和Web底层结构的人编写的。

###第一章 HTTP概述

Web浏览器、服务器和相关的web应用程序都是通过HTTP相互通信的。HTTP是现代全球因特网中使用的公共语言。

HTTP使用的是可靠的数据传输服务协议。

Web内容都是存储在Web服务器上的，Web服务器所用的是HTTP协议，因此常被称为HTTP服务器。

客户端向服务器发送HTTP请求，服务器会在HTTP响应中回送所请求的数据。
 

MIME是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔。

- HTML 格式的文本文档由 text/html 类型来标记。
- 普通的ASCII文本文档由text/plain类型来标记。
- JPEG 版本的图片为 image/jpeg 类型。
- GIF 格式的图片为 image/gif 类型。
- Apple 的 QuickTime 电影为 video/quicktime 类型。
- 微软的PowerPoint演示文件为application/vnd.ms-powerpoint类型。

服务器资源名称被称为统一资源标识符(Uniform Resource Identifier, URI)，URI就像因特网上的邮政地址一样，在世界范围内唯一标识并定位信息资源。

URI有两种形式: URL和URN

统一资源定位符URL是资源标识符最常见的形式。URL描述了一台特定服务器上某资源的特定位置。

大部分 URL 都遵循一种标准格式，这种格式包含三个部分:

- URL 的第一部分被称为方案(scheme)，说明了访问资源所使用的协议类型。这 部分通常就是 HTTP 协议(http://)。
- 第二部分给出了服务器的因特网地址(比如，www.joes-hardware.com)。
- 其余部分指定了Web服务器上的某个资源(比如，/specials/saw-blade.gif)。

现在，几乎所有的 URI 都是 URL。

URI 的第二种形式就是统一资源名(URN)。URN 是作为特定内容的唯一名称使用 的，与目前的资源所在地无关。使用这些与位置无关的 URN，就可以将资源四处搬 移。通过 URN，还可以用同一个名字通过多种网络访问协议来访问资源。

一个HTTP事务由一条请求命令和一个响应结果组成。这种通信是通过名为HTTP报文(HTTP message)的格式化数据块进行的。

HTTP支持几种不同的命令，这些命令被称为HTTP方法(HTTP method)。
每条HTTP请求报文都包含一个方法。这个方法告诉服务器要执行什么动作(获取一个web页面，运行一个网关程序，删除一个文件等)

常见的HTTP方法:

- GET		从服务器向客户端发送命名资源

- PUT		将来自客户端的数据存储到一个命名的服务器资源中去

- DELETE		从服务器中删除命名资源

- POST		将客户端数据发送到一个服务器网关应用程序

- HEAD		仅发送命名资源响应中的HTTP首部

每条HTTP报文返回时都会携带一个状态码。状态码是一个三位数字的代码， 告知客户端请求是否成功，或者是否需要采取其他动作

HTTP报文都是纯文本，不是二进制代码，所以人们可以很方便的对其进行读写。

从Web客户端发往Web服务器的HTTP报文称为请求报文(request message)。从 服务器发往客户端的报文称为响应报文(response message)，此外没有其他类型的 HTTP 报文


HTTP 报文包括以下三个部分。

- 起始行 报文的第一行就是起始行，在请求报文中用来说明要做些什么，在响应报文中说 明出现了什么情况。
- 首部字段 起始行后面有零个或多个首部字段。每个首部字段都包含一个名字和一个值，为 了便于解析，两者之间用冒号(:)来分隔。首部以一个空行结束。添加一个首 部字段和添加新行一样简单。
- 主体 空行之后就是可选的报文主体了，其中包含了所有类型的数据。请求主体中包括 了要发送给 Web 服务器的数据;响应主体中装载了要返回给客户端的数据。起 始行和首部都是文本形式且都是结构化的，而主体则不同，主体中可以包含任意 的二进制数据(比如图片、视频、音轨、软件程序)。当然，主体中也可以包含 文本。

HTTP是个应用层的协议。HTTP无需操心网络通信的具体细节；它把联网的细节都交给了通用、可靠的因特网传输协议TCP/IP。

TCP提供了:

- 无差错的数据传输；
- 按序传输(数据总是会按照发送的顺序送达)
- 未分段的数据流(可以在任一时刻以任意尺寸将数据发送出去)

因特网自身就是基于 TCP/IP 的，TCP/IP 是全世界的计算机和网络设备常用的层次 化分组交换网络协议集。TCP/IP 隐藏了各种网络和硬件的特点及弱点，使各种类型 的计算机和网络都能够进行可靠地通信。

只要建立了 TCP 连接，客户端和服务器之间的报文交换就不会丢失、不会被破坏， 也不会在接收时出现错序了。

HTTP网路协议栈:

HTTP		应用层
TCP		传输层
IP			网路层
网络特有的链路接口		数据链路层
物理网络硬件		物理层

在HTTP客户端向服务器发送报文之前，需要用网际协议(Internet Protocol，IP) 地址和端口号在客户端和服务器之间建立一条 TCP/IP 连接。

域名服务(Domain Name Service， DNS)

HTTP 的 URL 中没有端口号时，可以假设默认端口号是 80

浏览器是怎样通过 HTTP 显示位于远端服务器中的某个简单 HTML 资源的:

步骤如下:

(a) 浏览器从 URL 中解析出服务器的主机名;
(b) 浏览器将服务器的主机名转换成服务器的 IP 地址; (c) 浏览器将端口号(如果有的话)从 URL 中解析出来; (d) 浏览器建立一条与 Web 服务器的 TCP 连接;
(e) 浏览器向服务器发送一条 HTTP 请求报文;
(f) 服务器向浏览器回送一条 HTTP 响应报文;
(g) 关闭连接，浏览器显示文档。

####Web的结构组件

- 代理
位于客户端和服务器之间的 HTTP 中间实体。

- 缓存
HTTP 的仓库，使常用页面的副本可以保存在离客户端更近的地方。

- 网关
连接其他应用程序的特殊 W eb 服务器。

- 隧道
对 HTTP 通信报文进行盲转发的特殊代理。

- Agent 代理
发起自动 HTTP 请求的半智能 Web 客户端。

代理位于客户端和服务器之间，接收所有客户端的 HTTP 请求，并 将这些请求转发给服务器(可能会对请求进行修改之后转发)。对用户来说，这些应 用程序就是一个代理，代表用户访问服务器。出于安全考虑，通常会将代理作为转发所有 Web 流量的可信任中间节点使用。代理 还可以对请求和响应进行过滤


Web缓存(Web cache)或代理缓存(proxy cache)是一种特殊的HTTP代理服务 器，可以将经过代理传送的常用文档复制保存起来。下一个请求同一文档的客户端 就可以享受缓存的私有副本所提供的服务了。客户端从附近的缓存下载文档会比从远程 Web 服务器下载快得多


网关(gateway)是一种特殊的服务器，作为其他服务器的中间实体使用。通常用于 将 HTTP 流量转换成其他的协议。网关接受请求时就好像自己是资源的源端服务器 一样。客户端可能并不知道自己正在与一个网关进行通信。

隧道(tunnel)是建立起来之后，就会在两条连接之间对原始数据进行盲转发的 HTTP 应用程序。HTTP 隧道通常用来在一条或多条 HTTP 连接上转发非 HTTP 数 据，转发时不会窥探数据。
HTTP 隧道的一种常见用途是通过 HTTP 连接承载加密的安全套接字层(SSL， Secure Sockets Layer)流量，这样SSL流量就可以穿过只允许Web流量通过的防 火墙了。如图 1-14 所示，HTTP/SSL 隧道收到一条 HTTP 请求，要求建立一条到目 的地址和端口的输出连接，然后在 HTTP 信道上通过隧道传输加密的 SSL 流量，这 样就可以将其盲转发到目的服务器上去了。

用户 Agent 代理(或者简称为 Agent 代理)是代表用户发起 HTTP 请求的客户端程 序。所有发布Web请求的应用程序都是HTTP Agent代理



















